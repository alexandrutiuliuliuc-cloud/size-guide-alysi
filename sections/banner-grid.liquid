{{ 'section-banner-grid.css' | asset_url | stylesheet_tag }}

{%- liquid
  assign mobile_sizes = '(max-width: 767px) calc(100vw / ' | append: section.settings.section_columns_mobile | append: ')'
  assign tablet_sizes = '(max-width: 1023px) calc(100vw / ' | append: section.settings.section_columns_tablet | append: ')'
  assign desktop_sizes = 'calc(100vw / ' | append: section.settings.section_columns_desktop | append: ')'
  assign sizes = mobile_sizes | append: ', ' | append: tablet_sizes | append: ', ' | append: desktop_sizes  
-%}

<div
  id="{{ section.id }}"
  class="pt pb sm-pt sm-pb container sm-down-edge-to-edge banner-grid-section {{ section.settings.color_scheme }}{% if section.settings.enable_full_width %} edge-to-edge{% endif %}"
  style="
    --pt: {{ section.settings.padding_top | append: 'px' }};
    --pb: {{ section.settings.padding_bottom | append: 'px' }};
    --sm-pt: {{ section.settings.md_padding_top | append: 'px' }};
    --sm-pb: {{ section.settings.md_padding_bottom | append: 'px' }};
  ">

  <div 
    class="grid grid-cols-{{ section.settings.section_columns_mobile }} sm-grid-cols-{{ section.settings.section_columns_tablet }} md-grid-cols-{{ section.settings.section_columns_desktop }}"
    style="--gap: {{ section.settings.grid_gap }}px;">
    {%- for block in section.blocks -%}
      <div
        class="banner-grid-section__item banner-grid-section__item--{{ block.type }}{% unless block.type == 'text'%} aspect-ratio--{{ section.settings.block_aspect_ratio }}{% endunless %}{% if block.settings.text_alignment != blank %} {{ block.settings.text_alignment }}{% endif %}{% if block.settings.color_scheme != blank %} {{ block.settings.color_scheme }}{% endif %}"
        data-block-id="{{ block.id }}"
        {%- if block.type == 'text' -%}
        style="place-content: {{ block.settings.text_position }}"
        {%- endif -%}
        {{ block.shopify_attributes }}>

        {%- case block.type -%}
          {%- when 'image' or 'video' -%}
          {%- if block.settings.media_link != blank -%}
            <a href="{{ block.settings.media_link }}">
            {%- endif -%}

            {%- if block.type == 'image' -%}
              {%- render 'img',
                src: block.settings.image,
                lazyload: true,
                aspect_ratio: section.settings.block_aspect_ratio,
                sizes: sizes -%}
            {%- elsif block.type == 'video' -%}
              {%- render 'video',
                src: block.settings.video_url,
                autoplay: true,
                loop: true,
                aspect_ratio: section.settings.block_aspect_ratio,
                lazyload: true -%}
            {%- endif -%}

            {%- if block.settings.title != blank -%}
              {%- liquid
                assign contrast_test = block.settings.text_color | color_contrast: '#ffffff'
                if contrast_test < 4.5
                  assign text_on_primary = '#000000'
                else
                  assign text_on_primary = '#ffffff'
                endif
              -%}

              {% style %}
                .banner-grid-section__item[data-block-id="{{ block.id }}"] .banner-grid-section__item__overlay::before {
                  background-color: {{ block.settings.overlay_color }};
                  opacity: {{ block.settings.overlay_opacity | divided_by: 100.00 }};
                }
              {% endstyle %}
              <div
                class="banner-grid-section__item__overlay flex {{ block.settings.content_alignment }} p-{{ block.settings.padding }}"
                style="
                  --primary-foreground: {{ block.settings.text_color }};
                  color: var(--primary-foreground);
                  {% if block.settings.title_style contains 'btn' %}
                  --button-primary-background: {{ block.settings.text_color }};
                  --button-primary-foreground: {{ text_on_primary }};
                  {% endif %}
                ">
                <span class="banner-grid-section__item__heading {{ block.settings.title_style }}{% if block.settings.title_style contains 'btn' and block.settings.media_link == blank %} disabled{% endif %}">{{ block.settings.title | newline_to_br }}</span>
              </div>
            {%- endif -%}

            {%- if block.settings.media_link != blank -%}
            </a>
          {%- endif -%}

          {%- when 'text' -%}
          <div class="p-{{ block.settings.padding }}">

            {%- if block.settings.svg != blank -%}
              <div class="svg mb-24">{{ block.settings.svg }}</div>
            {%- endif -%}

            {%- if block.settings.subtitle != blank -%}
              <h4 class="subheading mb-8">{{ block.settings.subtitle }}</h3>
            {%- endif -%}

            {%- if block.settings.title != blank -%}
              <h3 class="h2 mb-16">{{ block.settings.title }}</h3>
            {%- endif -%}

            {%- if block.settings.richtext != blank -%}
              <div class="rte rte--wide mb-16">{{ block.settings.richtext }}</div>
            {%- endif -%}

            {%- if block.settings.button_label != blank -%}
              {%- render 'button',
                label: block.settings.button_label,
                link: block.settings.button_link,
                style: block.settings.button_style,
                color_scheme: block.settings.color_scheme -%}
            {%- endif -%}
          </div>

          {%- when 'product' -%}
          {%- if block.settings.product_card_content == 'content--none' -%}
            {%- assign card_aspect_ratio = section.settings.block_aspect_ratio -%}
          {%- else -%}
            {%- assign card_aspect_ratio = settings.product_card_aspect_ratio -%}
          {%- endif -%}
          {%- render 'card-product',
            product: block.settings.product,
            aspect_ratio: card_aspect_ratio,
            text_align: block.settings.text_alignment,
            ipr_desktop: section.settings.section_columns_desktop,
            ipr_mobile: section.settings.section_columns_mobile,
            class: block.settings.product_card_content,
            sizes: sizes -%}
        {%- endcase -%}
      </div>
    {%- endfor -%}
  </div>
</div>

{% schema %}
  {
    "name": "t:sections.banner-grid.name",
    
    "disabled_on": {
      "groups": ["header", "footer", "aside"]
    },
    "settings": [
      {
        "type": "paragraph",
        "content": "t:sections.banner-grid.info"
      },
      {
        "id": "block_aspect_ratio",
        "type": "select",
        "label": "t:sections.banner-grid.settings.block_aspect_ratio.label",
        "info": "t:sections.banner-grid.settings.block_aspect_ratio.info",
        "default": "portrait",
        "options": [
          {
            "value": "portrait",
            "label": "t:sections.images.aspect_ratio.portrait_2_3"
          },
          {
            "value": "portrait_alt",
            "label": "t:sections.images.aspect_ratio.portrait_3_4"
          },
          {
            "value": "square",
            "label": "t:sections.images.aspect_ratio.square"
          },
          {
            "value": "landscape",
            "label": "t:sections.images.aspect_ratio.landscape_16_9"
          }
        ]
      },
      {
        "type": "range",
        "id": "grid_gap",
        "label": "t:sections.layout.grid_gap",
        "unit": "px",
        "min": 0,
        "max": 40,
        "default": 3
      },
      {
        "type": "select",
        "id": "color_scheme",
        "label": "t:sections.colors.color_scheme.label",
        "options": [
          {
            "value": "color-main",
            "label": "t:sections.colors.color_scheme.main"
          },
          {
            "value": "color-main-inverted",
            "label": "t:sections.colors.color_scheme.main_inverted"
          },
          {
            "value": "color-accent",
            "label": "t:sections.colors.color_scheme.accent"
          },
          {
            "value": "color-accent-inverted",
            "label": "t:sections.colors.color_scheme.accent_inverted"
          }
        ]
      },
      {
        "type": "header",
        "content": "t:sections.headers.desktop_layout"
      },
      {
        "type": "checkbox",
        "id": "enable_full_width",
        "label": "t:sections.layout.section_width.full_width",
        "default": true
      },
      {
        "type": "range",
        "id": "section_columns_desktop",
        "label": "t:sections.layout.columns",
        "min": 2,
        "max": 5,
        "step": 1,
        "default": 3
      },
      {
        "type": "range",
        "id": "md_padding_top",
        "min": 0,
        "max": 160,
        "step": 8,
        "unit": "px",
        "label": "t:sections.layout.margin_top",
        "default": 40
      },
      {
        "type": "range",
        "id": "md_padding_bottom",
        "min": 0,
        "max": 160,
        "step": 8,
        "unit": "px",
        "label": "t:sections.layout.margin_bottom",
        "default": 40
      },
      {
        "type": "header",
        "content": "t:sections.headers.tablet_layout"
      },
      {
        "type": "range",
        "id": "section_columns_tablet",
        "label": "t:sections.layout.columns",
        "min": 2,
        "max": 4,
        "step": 1,
        "default": 2
      },
      {
        "type": "paragraph",
        "content": "t:sections.paragraphs.tablet_layout_info"
      },
      {
        "type": "header",
        "content": "t:sections.headers.mobile_layout"
      },
      {
        "type": "range",
        "id": "section_columns_mobile",
        "label": "t:sections.layout.columns",
        "min": 1,
        "max": 3,
        "step": 1,
        "default": 1
      },
      {
        "type": "range",
        "id": "padding_top",
        "min": 0,
        "max": 160,
        "step": 8,
        "unit": "px",
        "label": "t:sections.layout.margin_top",
        "default": 24
      },
      {
        "type": "range",
        "id": "padding_bottom",
        "min": 0,
        "max": 160,
        "step": 8,
        "unit": "px",
        "label": "t:sections.layout.margin_bottom",
        "default": 24
      }
    ],
    "blocks": [
      {
        "type": "image",
        "name": "t:sections.blocks.image.name",
        "settings": [
          {
            "type": "image_picker",
            "id": "image",
            "label": "t:sections.inputs.image_picker.image"
          },
          {
            "type": "url",
            "id": "media_link",
            "label": "t:sections.inputs.url.banner_link",
            "info": "t:sections.banner-grid.blocks.media_link__info"
          },
          {
            "type": "header",
            "content": "t:sections.headers.content"
          },
          {
            "type": "textarea",
            "id": "title",
            "label": "t:sections.inputs.text.title"
          },
          {
            "type": "select",
            "id": "title_style",
            "label": "t:sections.typography.style_options.heading_style_label",
            "default": "h3",
            "info": "t:sections.banner-grid.blocks.title_style__info",
            "options": [
              {
                "value": "h3",
                "label": "t:sections.typography.style_options.heading",
                "group": "t:sections.typography.style_options.text_group"
              },
              {
                "value": "body-text",
                "label": "t:sections.typography.style_options.body_text",
                "group": "t:sections.typography.style_options.text_group"
              },
              {
                "value": "subheading",
                "label": "t:sections.inputs.text.subtitle",
                "group": "t:sections.typography.style_options.text_group"
              },
              {
                "value": "btn btn--primary",
                "label": "t:sections.typography.style_options.primary_button",
                "group": "t:sections.typography.style_options.button_group"
              },
              {
                "value": "btn btn--secondary",
                "label": "t:sections.typography.style_options.secondary_button",
                "group": "t:sections.typography.style_options.button_group"
              },
              {
                "value": "btn btn--link",
                "label": "t:sections.typography.style_options.link",
                "group": "t:sections.typography.style_options.button_group"
              }
            ]
          },
          {
            "type": "select",
            "id": "content_alignment",
            "label": "t:sections.layout.position.heading_label",
            "default": "vertical-bottom horizontal-left",
            "options": [
              {
                "value": "vertical-top horizontal-left",
                "label": "t:sections.layout.position.options.top_left"
              },
              {
                "value": "vertical-top horizontal-center",
                "label": "t:sections.layout.position.options.top_center"
              },
              {
                "value": "vertical-top horizontal-right",
                "label": "t:sections.layout.position.options.top_right"
              },
              {
                "value": "vertical-center horizontal-left",
                "label": "t:sections.layout.position.options.middle_left"
              },
              {
                "value": "vertical-center horizontal-center",
                "label": "t:sections.layout.position.options.middle_center"
              },
              {
                "value": "vertical-center horizontal-right",
                "label": "t:sections.layout.position.options.middle_right"
              },
              {
                "value": "vertical-bottom horizontal-left",
                "label": "t:sections.layout.position.options.bottom_left"
              },
              {
                "value": "vertical-bottom horizontal-center",
                "label": "t:sections.layout.position.options.bottom_center"
              },
              {
                "value": "vertical-bottom horizontal-right",
                "label": "t:sections.layout.position.options.bottom_right"
              }
            ]
          },
          {
            "type": "range",
            "id": "padding",
            "label": "t:sections.layout.padding",
            "min": 0,
            "max": 80,
            "step": 8,
            "default": 40,
            "unit": "px"
          },
          {
            "type": "color",
            "id": "text_color",
            "label": "t:sections.colors.heading_color",
            "default": "#FFFFFF"
          },
          {
            "type": "color",
            "id": "overlay_color",
            "label": "t:sections.colors.overlay_color",
            "default": "#000000"
          },
          {
            "type": "range",
            "id": "overlay_opacity",
            "label": "t:sections.colors.overlay_opacity",
            "default": 0,
            "min": 0,
            "max": 100,
            "step": 2,
            "unit": "%"
          }
        ]
      },
      {
        "type": "text",
        "name": "t:sections.blocks.text.name",
        "settings": [
          {
            "type": "header",
            "content": "t:sections.headers.content"
          },
          {
            "type": "html",
            "id": "svg",
            "label": "t:sections.images.svg.label",
            "info": "t:sections.images.svg.info"
          },
          {
            "type": "text",
            "id": "subtitle",
            "label": "t:sections.inputs.text.subtitle"
          },
          {
            "type": "text",
            "id": "title",
            "label": "t:sections.inputs.text.title",
            "default": "Text block"
          },
          {
            "type": "richtext",
            "id": "richtext",
            "label": "t:sections.inputs.text.text",
            "default": "<p>Text blocks are usefull for braking the grid feeling and to bring out additional inofrmation that needs more room and words.</p>"
          },
          {
            "type": "header",
            "content": "t:sections.headers.button"
          },
          {
            "type": "text",
            "id": "button_label",
            "label": "t:sections.inputs.text.button_label"
          },
          {
            "type": "url",
            "id": "button_link",
            "label": "t:sections.inputs.url.button_link"
          },
          {
            "type": "select",
            "id": "button_style",
            "label": "t:sections.buttons.style.label",
            "default": "primary",
            "options": [
              {
                "value": "primary",
                "label": "t:sections.buttons.style.primary"
              },
              {
                "value": "secondary",
                "label": "t:sections.buttons.style.secondary"
              },
              {
                "value": "link",
                "label": "t:sections.typography.style_options.link"
              }
            ]
          },
          {
            "type": "header",
            "content": "t:sections.headers.style_and_layout"
          },
          {
            "type": "select",
            "id": "color_scheme",
            "label": "t:sections.colors.color_scheme.label",
            "default": "color-main",
            "options": [
              {
                "value": "color-main",
                "label": "t:sections.colors.color_scheme.main"
              },
              {
                "value": "color-main-inverted",
                "label": "t:sections.colors.color_scheme.main_inverted"
              },
              {
                "value": "color-accent",
                "label": "t:sections.colors.color_scheme.accent"
              },
              {
                "value": "color-accent-inverted",
                "label": "t:sections.colors.color_scheme.accent_inverted"
              }
            ]
          },
          {
            "type": "range",
            "id": "padding",
            "label": "t:sections.layout.padding",
            "min": 0,
            "max": 80,
            "step": 8,
            "default": 40,
            "unit": "px"
          },
          {
            "type": "select",
            "id": "text_position",
            "label": "t:sections.layout.position.text_label",
            "default": "center",
            "options": [
              {
                "value": "start",
                "label": "t:sections.layout.position.options.top"
              },
              {
                "value": "center",
                "label": "t:sections.layout.position.options.middle"
              },
              {
                "value": "end",
                "label": "t:sections.layout.position.options.bottom"
              }
            ]
          },
          {
            "type": "select",
            "id": "text_alignment",
            "label": "t:sections.typography.text_align",
            "default": "text-align-center",
            "options": [
              {
                "value": "text-align-left",
                "label": "t:sections.layout.position.options.left"
              },
              {
                "value": "text-align-center",
                "label": "t:sections.layout.position.options.center"
              },
              {
                "value": "text-align-right",
                "label": "t:sections.layout.position.options.right"
              }
            ]
          }
        ]
      },
      {
        "type": "video",
        "name": "t:sections.blocks.video.name",
        "settings": [
          {
            "type": "text",
            "id": "video_url",
            "label": "t:sections.inputs.url.video_url",
            "info": "t:sections.inputs.url.video_url__info"
          },
          {
            "type": "url",
            "id": "media_link",
            "label": "t:sections.inputs.url.banner_link",
            "info": "t:sections.banner-grid.blocks.media_link__info"
          },
          {
            "type": "header",
            "content": "t:sections.headers.content"
          },
          {
            "type": "textarea",
            "id": "title",
            "label": "t:sections.inputs.text.title"
          },
          {
            "type": "select",
            "id": "title_style",
            "label": "t:sections.typography.style_options.heading_style_label",
            "default": "h3",
            "info": "t:sections.banner-grid.blocks.title_style__info",
            "options": [
              {
                "value": "h3",
                "label": "t:sections.inputs.text.title",
                "group": "t:sections.typography.style_options.text_group"
              },
              {
                "value": "body-text",
                "label": "t:sections.typography.style_options.body_text",
                "group": "t:sections.typography.style_options.text_group"
              },
              {
                "value": "subheading",
                "label": "t:sections.inputs.text.subtitle",
                "group": "t:sections.typography.style_options.text_group"
              },
              {
                "value": "btn btn--primary",
                "label": "t:sections.typography.style_options.primary_button",
                "group": "t:sections.typography.style_options.button_group"
              },
              {
                "value": "btn btn--secondary",
                "label": "t:sections.typography.style_options.secondary_button",
                "group": "t:sections.typography.style_options.button_group"
              },
              {
                "value": "btn btn--link",
                "label": "t:sections.typography.style_options.link",
                "group": "t:sections.typography.style_options.button_group"
              }
            ]
          },
          {
            "type": "select",
            "id": "content_alignment",
            "label": "t:sections.layout.position.heading_label",
            "default": "vertical-bottom horizontal-left",
            "options": [
              {
                "value": "vertical-top horizontal-left",
                "label": "t:sections.layout.position.options.top_left"
              },
              {
                "value": "vertical-top horizontal-center",
                "label": "t:sections.layout.position.options.top_center"
              },
              {
                "value": "vertical-top horizontal-right",
                "label": "t:sections.layout.position.options.top_right"
              },
              {
                "value": "vertical-center horizontal-left",
                "label": "t:sections.layout.position.options.middle_left"
              },
              {
                "value": "vertical-center horizontal-center",
                "label": "t:sections.layout.position.options.middle_center"
              },
              {
                "value": "vertical-center horizontal-right",
                "label": "t:sections.layout.position.options.middle_right"
              },
              {
                "value": "vertical-bottom horizontal-left",
                "label": "t:sections.layout.position.options.bottom_left"
              },
              {
                "value": "vertical-bottom horizontal-center",
                "label": "t:sections.layout.position.options.bottom_center"
              },
              {
                "value": "vertical-bottom horizontal-right",
                "label": "t:sections.layout.position.options.bottom_right"
              }
            ]
          },
          {
            "type": "range",
            "id": "padding",
            "label": "t:sections.layout.padding",
            "min": 0,
            "max": 80,
            "step": 8,
            "default": 40,
            "unit": "px"
          },
          {
            "type": "color",
            "id": "text_color",
            "label": "t:sections.colors.heading_color",
            "default": "#FFFFFF"
          },
          {
            "type": "color",
            "id": "overlay_color",
            "label": "t:sections.colors.overlay_color",
            "default": "#000000"
          },
          {
            "type": "range",
            "id": "overlay_opacity",
            "label": "t:sections.colors.overlay_opacity",
            "default": 0,
            "min": 0,
            "max": 100,
            "step": 2,
            "unit": "%"
          }
        ]
      },
      {
        "type": "product",
        "name": "t:sections.blocks.product.name",
        "settings": [
          {
            "type": "product",
            "id": "product",
            "label": "t:sections.inputs.product.label"
          },
          {
            "type": "paragraph",
            "content": "t:sections.banner-grid.blocks.product__paragraph"
          },
          {
            "type": "select",
            "id": "product_card_content",
            "label": "t:sections.banner-grid.blocks.product_card_content.label",
            "default": "",
            "options": [
              {
                "value": "",
                "label": "t:sections.banner-grid.blocks.product_card_content.options.default",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__theme_settings"
              },
              {
                "value": "content--name-and-price",
                "label": "t:sections.banner-grid.blocks.product_card_content.options.name_and_price",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__overwrite"
              },
              {
                "value": "content--name-only",
                "label": "t:sections.banner-grid.blocks.product_card_content.options.name_only",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__overwrite"
              },
              {
                "value": "content--none",
                "label": "t:sections.banner-grid.blocks.product_card_content.options.hide_all",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__overwrite"
              }
            ]
          },
          {
            "type": "select",
            "id": "text_alignment",
            "label": "t:sections.typography.text_align",
            "default": "",
            "options": [
              {
                "value": "",
                "label": "t:sections.banner-grid.blocks.product_card_content.options.default",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__theme_settings"
              },
              {
                "value": "text-align-left",
                "label": "t:sections.layout.position.options.left",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__overwrite"
              },
              {
                "value": "text-align-center",
                "label": "Center",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__overwrite"
              },
              {
                "value": "text-align-right",
                "label": "t:sections.layout.position.options.right",
                "group": "t:sections.banner-grid.blocks.product_card_content.options.group__overwrite"
              }
            ]
          }
        ]
      }
    ],
    "presets": [
      {
        "name": "t:sections.banner-grid.name",
        "settings": {},
        "blocks": [
          {
            "type": "image"
          },
          {
            "type": "text"
          },
          {
            "type": "image"
          },
          {
            "type": "video"
          },
          {
            "type": "product"
          },
          {
            "type": "image"
          }
        ]
      }
    ]
  }
{% endschema %}